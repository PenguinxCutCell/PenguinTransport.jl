var documenterSearchIndex = {"docs":
[{"location":"api/#API-Reference","page":"API Reference","title":"API Reference","text":"","category":"section"},{"location":"api/#Core-Types","page":"API Reference","title":"Core Types","text":"","category":"section"},{"location":"api/#Build-and-State","page":"API Reference","title":"Build and State","text":"","category":"section"},{"location":"api/#Time-Varying-Updaters","page":"API Reference","title":"Time-Varying Updaters","text":"","category":"section"},{"location":"api/#Steady-Matrix-Free-Solve","page":"API Reference","title":"Steady Matrix-Free Solve","text":"","category":"section"},{"location":"api/#PenguinSolverCore-Integration-Points","page":"API Reference","title":"PenguinSolverCore Integration Points","text":"The package implements:\n\nPenguinSolverCore.rhs!(du, sys, u, p, t)\nPenguinSolverCore.mass_matrix(sys)\nPenguinSolverCore.rebuild!(sys, u, p, t)\n\nand uses UpdateManager schedules through PenguinSolverCore.apply_scheduled_updates!.","category":"section"},{"location":"api/#PenguinTransport.TransportProblem","page":"API Reference","title":"PenguinTransport.TransportProblem","text":"TransportProblem(; kappa=0, bc_diff=nothing, bc_adv=nothing, scheme=Centered(),\n                   vel_omega=0, vel_gamma=vel_omega, source=nothing, embedded_inflow=nothing)\n\nUser-facing specification for scalar transport:\n\nM*Ṫ = C(uω, uγ; scheme)T + κΔ(Tω, Tγ) + S.\n\nkappa: scalar diffusivity (0 gives pure advection).\nbc_diff: diffusion boundary conditions (BoxBC); defaults to zero-Neumann.\nbc_adv: advection boundary conditions (AdvBoxBC); defaults to outflow.\nscheme: advection discretization (Centered, Upwind1, MUSCL).\nvel_omega, vel_gamma: velocity payloads (scalar/tuple/vector/function).\nsource: optional source callback/payload.\nembedded_inflow: optional embedded-interface inflow trace (scalar/vector/callback or CartesianOperators.AbstractEmbeddedAdvBC), imposed only where u⋅n < 0 on cut cells.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.TransportSystem","page":"API Reference","title":"PenguinTransport.TransportSystem","text":"TransportSystem{N,T} <: PenguinSolverCore.AbstractSystem\n\nSemidiscrete transport system built by build_system.\n\nThe runtime state is reduced to active ω DOFs while full-length caches are kept internally for kernel operators and boundary-condition handling.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.build_system","page":"API Reference","title":"PenguinTransport.build_system","text":"build_system(moments, prob; vtol=nothing)\n\nBuild a TransportSystem from geometric moments and a TransportProblem.\n\nActive ω DOFs are selected using:\n\nmaterial cells (cell_type != 0),\npositive volume above vtol,\nremoval of padded boundary cells.\n\nReturns a system with reduced DOF map, diagonal mass matrix, kernel operators, and preallocated full/reduced work buffers.\n\n\n\n\n\n","category":"function"},{"location":"api/#PenguinTransport.full_state","page":"API Reference","title":"PenguinTransport.full_state","text":"full_state(sys, u_omega)\n\nReconstruct full-length ω and γ scalar fields from a reduced ω state.\n\nReturns (Tω_full, Tγ_full) as copies suitable for plotting/debug.\n\n\n\n\n\n","category":"function"},{"location":"api/#PenguinTransport.cfl_dt","page":"API Reference","title":"PenguinTransport.cfl_dt","text":"cfl_dt(sys, u; cfl=0.5, p=nothing, t=0, include_diffusion=true)\n\nEstimate a stable explicit timestep from advective and optional diffusive limits.\n\nAdvection: dt <= min_d(Δx_d / max|u_d|).\nDiffusion (if include_diffusion && kappa > 0): dt <= 1 / (2κ * Σ_d 1/Δx_d^2).\n\nReturns cfl * min(dt_adv, dt_diff), or Inf if no active restriction exists.\n\n\n\n\n\n","category":"function"},{"location":"api/#PenguinTransport.KappaUpdater","page":"API Reference","title":"PenguinTransport.KappaUpdater","text":"KappaUpdater(f)\n\nUpdater that sets sys.kappa = f(...) at scheduled times. Returns :rhs_only.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.SchemeUpdater","page":"API Reference","title":"PenguinTransport.SchemeUpdater","text":"SchemeUpdater(f)\n\nUpdater that sets sys.scheme = f(...) (AdvectionScheme expected). Returns :rhs_only.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.VelocityUpdater","page":"API Reference","title":"PenguinTransport.VelocityUpdater","text":"VelocityUpdater(f; which=:both)\n\nUpdater for transport velocities.\n\nwhich=:omega: update only uω.\nwhich=:gamma: update only uγ.\nwhich=:both: update both (payload may also be named tuple with :omega/:gamma).\n\nReturns :rhs_only.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.AdvBCUpdater","page":"API Reference","title":"PenguinTransport.AdvBCUpdater","text":"AdvBCUpdater(f)\n\nUpdater for advection boundary conditions (AdvBoxBC payload).\n\nIf periodicity changes, marks operators dirty and returns :matrix so rebuild is triggered. Otherwise returns :rhs_only.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.SourceUpdater","page":"API Reference","title":"PenguinTransport.SourceUpdater","text":"SourceUpdater(f)\n\nUpdater for source specification. Payload can be nothing, a callable, or a fixed scalar/vector value (wrapped internally). Returns :rhs_only.\n\n\n\n\n\n","category":"type"},{"location":"api/#PenguinTransport.steady_linear_problem","page":"API Reference","title":"PenguinTransport.steady_linear_problem","text":"steady_linear_problem(sys; p=nothing, t=0, u0=nothing, u_eval=nothing)\n\nConstruct a matrix-free steady linear problem A*x = b using LinearSolve.FunctionOperator.\n\nVelocities and optional γ override are frozen at (u_eval, p, t). The affine transport/source contributions are shifted to the right-hand side.\n\n\n\n\n\n","category":"function"},{"location":"api/#PenguinTransport.steady_solve","page":"API Reference","title":"PenguinTransport.steady_solve","text":"steady_solve(sys; alg=LinearSolve.SimpleGMRES(), p=nothing, t=0, u0=nothing, u_eval=nothing, kwargs...)\n\nSolve the steady matrix-free transport problem produced by steady_linear_problem with LinearSolve.solve.\n\n\n\n\n\n","category":"function"},{"location":"equations/#Equations","page":"Equations","title":"Equations","text":"PenguinTransport.jl solves scalar transport in semidiscrete form:\n\nM dot T =\nmathcal C(u^omega u^gamma textscheme)T\n+ kappaDelta(T^omega T^gamma)\n+ S\n\nwhere:\n\nM is diagonal mass matrix built from active-cell volumes.\n\\mathcal C is the kernel convection operator from CartesianOperators.\n\\Delta is the kernel cut-cell Laplacian.\nS is source term (mass-weighted internally by cell volumes).","category":"section"},{"location":"equations/#State-Representation","page":"Equations","title":"State Representation","text":"Unknown state u is reduced to active \\omega DOFs.\nFull fields are rebuilt internally each RHS call:\nTω_full via prolongation from reduced state.\nTγ_full defaults to Tω_full (monophasic closure), or optional override through gammafun.","category":"section"},{"location":"equations/#Special-Cases","page":"Equations","title":"Special Cases","text":"Pure advection: kappa == 0 uses convection!.\nAdvection-diffusion: kappa > 0 uses advection_diffusion!.","category":"section"},{"location":"equations/#Steady-Matrix-Free-Form","page":"Equations","title":"Steady Matrix-Free Form","text":"For steady solves, the package constructs a matrix-free linear problem:\n\nA x = b\n\nwith:\n\nA represented by LinearSolve.FunctionOperator.\nA*x evaluated by kernel transport operator on full caches, then restricted.\naffine part removed with a zero-state probe.\nsource contribution shifted to the right-hand side.","category":"section"},{"location":"design/#Design-Notes","page":"Design Notes","title":"Design Notes","text":"","category":"section"},{"location":"design/#Reduced-State-Architecture","page":"Design Notes","title":"Reduced-State Architecture","text":"The solver state is reduced to active \\omega cells only.\nFull vectors (Tω_full, Tγ_full, du_full) are internal caches.\nRestriction/prolongation use PenguinSolverCore.DofMap.","category":"section"},{"location":"design/#\\gamma-Handling","page":"Design Notes","title":"\\gamma Handling","text":"Current default is monophasic closure:\nTγ_full := Tω_full\nOptional internal gammafun hook allows override payloads:\nscalar\nfull-length vector\nreduced-length vector mapped to active \\omega.","category":"section"},{"location":"design/#Velocity-Payload-Normalization","page":"Design Notes","title":"Velocity Payload Normalization","text":"vel_omega / vel_gamma accept:\n\nscalar (1D only)\ntuple of scalars (NTuple{N,Number})\ntuple of full/reduced vectors\ncallables with polymorphic signatures:\n(sys, u, p, t)\n(u, p, t)\n(t)\n()","category":"section"},{"location":"design/#Rebuild-Contract","page":"Design Notes","title":"Rebuild Contract","text":"rebuild! refreshes kernel operators only when ops_dirty=true.\nAdvBCUpdater triggers :matrix rebuild only when periodicity pattern changes.","category":"section"},{"location":"design/#Steady-Matrix-Free-Solve","page":"Design Notes","title":"Steady Matrix-Free Solve","text":"steady_linear_problem freezes runtime fields at (u_eval, p, t).\nBuilds a FunctionOperator evaluating A*x from kernel transport on full caches.\nAffine transport offset and source are moved to RHS.","category":"section"},{"location":"examples/#Examples","page":"Examples","title":"Examples","text":"Run from repository root:\n\njulia --project examples/<file>.jl","category":"section"},{"location":"examples/#advection_1d_periodic.jl","page":"Examples","title":"advection_1d_periodic.jl","text":"Periodic Gaussian advection.\nCompares Upwind1 vs MUSCL.\nUses cfl_dt and fixed-step Rosenbrock23.","category":"section"},{"location":"examples/#advection_1d_sine_convergence.jl","page":"Examples","title":"advection_1d_sine_convergence.jl","text":"Full-domain periodic advection (levelset = -1) with analytical sine-wave solution.\nUses manual mass-matrix-aware SSP RK2 and CFL = 0.5.\nReports refinement errors/orders in L1 and L2 for:\nCentered\nMUSCL(MC())\nMUSCL(VanLeer())\nUses L1 as the primary limiter-scheme convergence metric.","category":"section"},{"location":"examples/#advection_diffusion_1d.jl","page":"Examples","title":"advection_diffusion_1d.jl","text":"Periodic smooth advection-diffusion with kappa > 0.\nDemonstrates CFL-based step selection with diffusion term included.","category":"section"},{"location":"examples/#rotating_2d_transport.jl","page":"Examples","title":"rotating_2d_transport.jl","text":"2D rotating velocity field.\nDemonstrates full-domain transport setup in two dimensions.","category":"section"},{"location":"examples/#embedded_boundary_inflow_2d.jl","page":"Examples","title":"embedded_boundary_inflow_2d.jl","text":"Cut-cell geometry (levelset != -1) with a circular embedded boundary.\nDemonstrates inflow-only interface closure: impose trace only where u⋅n<0.\nPrints inflow/outflow interface counts and RHS norms with/without interface injection.","category":"section"},{"location":"examples/#transport_diffusion_strang.jl","page":"Examples","title":"transport_diffusion_strang.jl","text":"Coupling sketch using Strang splitting:\nhalf diffusion step\nfull transport step\nhalf diffusion step\nUses two TransportSystems with different physics settings.","category":"section"},{"location":"validation/#Validation","page":"Validation","title":"Validation","text":"The test suite includes numerical validation contracts beyond unit checks.","category":"section"},{"location":"validation/#Conservation","page":"Validation","title":"Conservation","text":"Periodic mass conservation: advection-only runs preserve total mass.\nChecked both semidiscrete residual (sum(du)) and time-integrated mass drift.","category":"section"},{"location":"validation/#Smooth-Accuracy","page":"Validation","title":"Smooth Accuracy","text":"Order test on periodic sine wave:\nFull-domain setup (levelset = -1) with analytical solution.\nTime integration uses manual mass-matrix-aware SSP RK2 at CFL = 0.5.\nCentered scheme: clear second-order in both L1 and L2.\nMUSCL (MC, VanLeer): clear second-order in L1 (primary FV metric), with lower but convergent L2 due limiter activation near smooth extrema.","category":"section"},{"location":"validation/#Nonsmooth-Behavior","page":"Validation","title":"Nonsmooth Behavior","text":"Step-function advection:\nOvershoot/undershoot checks for Upwind1 and MUSCL.\nGuards against unstable limiter/boundary regressions.","category":"section"},{"location":"validation/#Advection-Diffusion-Consistency","page":"Validation","title":"Advection-Diffusion Consistency","text":"Manufactured solution test:\nConstructs source term so chosen exact field satisfies semidiscrete equation.\nVerifies final-time relative error against analytic target.","category":"section"},{"location":"validation/#Performance-Gate","page":"Validation","title":"Performance Gate","text":"rhs! allocation regression test ensures runtime allocations remain small on a representative 1D case.","category":"section"},{"location":"boundary-conditions/#Boundary-Conditions","page":"Boundary Conditions","title":"Boundary Conditions","text":"Two BC sets are used:\n\nDiffusion BC: bc_diff::CartesianOperators.BoxBC\nAdvection BC: bc_adv::CartesianOperators.AdvBoxBC","category":"section"},{"location":"boundary-conditions/#Diffusion-BC-(BoxBC)","page":"Boundary Conditions","title":"Diffusion BC (BoxBC)","text":"Supported by CartesianOperators.kernel_ops(...; bc=bc_diff):\n\nDirichlet\nNeumann\nPeriodic\n\nDefault (bc_diff=nothing) is all-zero Neumann via BoxBC(Val(N), T).","category":"section"},{"location":"boundary-conditions/#Advection-BC-(AdvBoxBC)","page":"Boundary Conditions","title":"Advection BC (AdvBoxBC)","text":"Supported by kernel convection:\n\nAdvPeriodic\nAdvOutflow\nAdvInflow(value)\n\nDefault (bc_adv=nothing) is all outflow via AdvBoxBC(Val(N), T).","category":"section"},{"location":"boundary-conditions/#Stencil-Behavior","page":"Boundary Conditions","title":"Stencil Behavior","text":"Advection internally uses a stencil BC derived from advection periodicity:\n\nperiodic advection side -> periodic stencil.\nnon-periodic advection side -> zero-Neumann stencil.\n\nThe advection BC object is still passed to convection kernels to apply inflow/outflow logic.","category":"section"},{"location":"boundary-conditions/#Runtime-BC-Updates","page":"Boundary Conditions","title":"Runtime BC Updates","text":"AdvBCUpdater can update advection BC during integration.\n\nIf periodicity pattern changes, system marks operators dirty and triggers rebuild.\nIf periodicity is unchanged, update is :rhs_only.","category":"section"},{"location":"boundary-conditions/#Embedded-Interface-Inflow-(Cut-Cells)","page":"Boundary Conditions","title":"Embedded Interface Inflow (Cut Cells)","text":"TransportProblem supports embedded_inflow=... for cut-cell advection.\n\nThis is an interface trace closure on the embedded boundary Γ, not a box-boundary condition.\nThe prescribed trace is imposed only on inflow interface segments (u⋅n < 0).\nOn outflow (u⋅n >= 0), no value is imposed and the interior trace is used.\n\nAccepted payloads:\n\nscalar (embedded_inflow=1.0)\nfull Nd vector\ncallback returning scalar/vector, or callback that fills destination buffer in-place","category":"section"},{"location":"#PenguinTransport.jl","page":"Home","title":"PenguinTransport.jl","text":"PenguinTransport.jl provides cut-cell scalar transport with reduced-state unknowns on active cells.\n\nIt supports:\n\nAdvection with Centered, Upwind1, and MUSCL schemes.\nOptional diffusion (kappa >= 0) in the same semidiscrete system.\nTime-integration via PenguinSolverCore + SciML.\nMatrix-free steady solves via LinearSolve.FunctionOperator.","category":"section"},{"location":"#Quick-Start","page":"Home","title":"Quick Start","text":"using PenguinTransport\nusing CartesianGeometry\nusing CartesianOperators\nusing PenguinSolverCore\nusing LinearAlgebra\n\nx = collect(range(0.0, 1.0; length=65))\nfull_domain(_x, _=0.0) = -1.0\nmoments = CartesianGeometry.geometric_moments(full_domain, (x,), Float64, zero; method=:implicitintegration)\n\nbc_adv = CartesianOperators.AdvBoxBC(\n    (CartesianOperators.AdvPeriodic(Float64),),\n    (CartesianOperators.AdvPeriodic(Float64),),\n)\nprob = TransportProblem(;\n    kappa = 0.01,\n    bc_adv = bc_adv,\n    scheme = CartesianOperators.Upwind1(),\n    vel_omega = 1.0,\n    vel_gamma = 1.0,\n)\nsys = build_system(moments, prob)\n\nu0 = rand(length(sys.dof_omega.indices))\ndu = similar(u0)\ndt = cfl_dt(sys, u0; cfl=0.45)\nPenguinSolverCore.rhs!(du, sys, u0, nothing, 0.0)\n\nprintln(length(u0), \", dt=\", dt, \", norm(du)=\", norm(du))","category":"section"},{"location":"#Documentation-Map","page":"Home","title":"Documentation Map","text":"Equations: PDE and semidiscrete form.\nBoundary Conditions: diffusion and advection BC behavior.\nNumerics: masks, stencils, schemes, CFL guidance.\nAPI Reference: exported constructors/functions.\nExamples: runnable scripts.\nValidation: conservation, order, boundedness, manufactured tests.\nDesign Notes: reduced-state layout, caches, and callbacks.","category":"section"},{"location":"#Figure","page":"Home","title":"Figure","text":"(Image: Periodic 1D advection comparison)","category":"section"},{"location":"numerics/#Numerics","page":"Numerics","title":"Numerics","text":"","category":"section"},{"location":"numerics/#Active-Cell-Masking","page":"Numerics","title":"Active-Cell Masking","text":"System build uses:\n\nmaterial mask: cell_type != 0 and V > vtol\npadding removal on high-index boundary plane (padded_mask)\nactive set dof_omega = DofMap(findall(mask))\n\nMass matrix:\n\nM = mathrmdiag(V_i)_i in omega","category":"section"},{"location":"numerics/#Advection-Schemes","page":"Numerics","title":"Advection Schemes","text":"scheme::CartesianOperators.AdvectionScheme:\n\nCentered()\nUpwind1()\nMUSCL(limiter) where limiter in {Minmod, MC, VanLeer}","category":"section"},{"location":"numerics/#Kernel-Work-Buffers","page":"Numerics","title":"Kernel Work Buffers","text":"RHS is evaluated with preallocated KernelWork buffers:\n\nwork_adv for convection\nwork_diff for diffusion/Laplacian\n\nThis keeps runtime allocations low.","category":"section"},{"location":"numerics/#CFL-Guidance","page":"Numerics","title":"CFL Guidance","text":"Use:\n\ndt = cfl_dt(sys, u; cfl=0.45)\n\ncfl_dt computes:\n\nadvection restriction from min(dx_d / max|u_d|)\noptional diffusion restriction from 1 / (2*kappa*sum(1/dx_d^2))\n\nand returns cfl * min(dt_adv, dt_diff).","category":"section"}]
}
